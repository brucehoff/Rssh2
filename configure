# !/bin/sh

## ### We download and build all the dependencides of libssh2 ###
## 
## ########## GET Libgpg-error #######
## export gpgerrorLibName=libgpg-error
## # download and unzip
## ./downloadsource.sh $gpgerrorLibName libgpg-error-1.17 libgpg-error-1.17.tar.bz2 ftp://ftp.gnupg.org/gcrypt/libgpg-error/
## # now build
## export gpgDownloadLocation=/tmp/$gpgerrorLibName
## export gpgInstallLocation=$gpgDownloadLocation/target
## pushd $gpgDownloadLocation
## # specify the install location using --prefix
## mkdir  $gpgInstallLocation
## ./configure --quiet --prefix=$gpgInstallLocation
## make
## make install
## popd
## 
## ########## GET Libgcrypt #######
## export gcryptLibName=libgcrypt
## # download and unzip
## ./downloadsource.sh $gcryptLibName libgcrypt-1.6.2 libgcrypt-1.6.2.tar.bz2 ftp://ftp.gnupg.org/gcrypt/libgcrypt/
## # now build
## export gcryptDownloadLocation=/tmp/$gcryptLibName
## export gcryptInstallLocation=$gcryptDownloadLocation/target
## pushd $gcryptDownloadLocation
## # Note:  There's a typo in the help for gcrypt's configure, which says the following param is 
## # called --with-libgpg-error-prefix, when it's actually called --with-gpg-error-prefix
## ./configure --quiet --with-gpg-error-prefix=$gpgInstallLocation --prefix=$gcryptInstallLocation
## make
## make install
## popd

########## GET libssh2 #######
export ssh2LibName=libssh2
./downloadsource.sh $ssh2LibName libssh2-1.4.3 libssh2-1.4.3.tar.gz http://www.libssh2.org/download/

# now run set-up
pushd /tmp/$ssh2LibName
# NOTE:  the "--with-libgcrypt-prefix" option doesn't work.  We must rely on the machine
# having openssl or gcrypt installed in the standard location
# ./configure --quiet --with-libgcrypt --with-libgcrypt-prefix=$gcryptInstallLocation CFLAGS=-fPIC
./configure --quiet CFLAGS=-fPIC
make
popd
