# !/bin/sh

export genericlibname=libssh2
export version=1.4.3
export versionedlibname=${genericlibname}-${version}
export zipname=${versionedlibname}.tar.gz
export remotepath=http://www.libssh2.org/download/${zipname}

# Retrieve the source code for libssh2

cd /tmp

# clean up any previous downloads
# ('set +e' keeps the script from terminating if the folder isn't there)
set +e
rm $zipname
rm -r $genericlibname

echo downloading $remotepath to /tmp/$(zipname)
# machines have either 'wget' or 'curl', so we try both
wget -O $zipname $remotepath
if [ "$?" -ne "0" ]; then
	curl -o $zipname $remotepath
fi
if [ "$?" -ne "0" ]; then
  echo "Failed to download $remotepath"
  exit 1
fi
set -e

echo extracting $zipname
# unzip the downloaded archive
tar xzf $zipname

# change the name of the unzipped folder from, say, libssh2-1.4.3 to libssh2
mv $versionedlibname $genericlibname

# remove the archive
rm $zipname

# now run set-up
cd $genericlibname
./configure --quiet CFLAGS=-fPIC

# next step is to run the make file, which is specified in src/Makevars
